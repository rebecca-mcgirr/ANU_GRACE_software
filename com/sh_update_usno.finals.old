#!/bin/csh -f

# script to download a new version of the usno.finals.data file, add to the file name the date of download and re-create
# the link of usno.finals.data to point to the new file
#
# P. Tregoning
# 24 July 2019

if ($#argv == 0)then
  echo "usage: sh_update_usno.finals [Y|N]"
  echo "sh_update_usno.finals will download a new file, call it usno.finals.data.YYYYMMDD (where YYYYMMDD is the date of download)"
  echo "Add Y to re-create the link of usno.finals.data to point to the new file"
  exit
else if ($#argv == 1)then
  set relink = $1
endif

echo $cwd
set D=`basename $cwd`
echo $D

if ( $D != "tables" ) then
    echo "sh_update_usno.finals should be run in ~/gg/grace/tables"
    exit
endif
#exit    
    
# use wget to download the file (called "finals.data")
#wget ftp://toshi.nofs.navy.mil/ser7/finals.data
#wget http://maia.usno.navy.mil/ser7/finals.data || wget http://toshi.nofs.navy.mil/ser7/finals.data || wget ftp://cddis.gsfc.nasa.gov/pub/products/iers/finals.data
wget ftp://cddis.gsfc.nasa.gov/pub/products/iers/finals.data

# what is today's date?
set YYMMDD = `~/gg/kf/bin/doy | tail -3 | head -1 | awk '{printf "%4d%2.2d%2.2d\n",substr($2,1,4),substr($2,6,2),substr($2,9,2)}'`

# rename the file
mv finals.data usno.finals.data.$YYMMDD

# relink if required
if ($relink == "Y")then
  rm usno.finals.data  >& /dev/null
  ln -f -s usno.finals.data.$YYMMDD usno.finals.data
else
  echo did not relink usno.finals.data to the new file
endif

ls -l usno.finals.data


